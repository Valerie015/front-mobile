"use client";

import type React from "react";
import { createContext, useContext, useState, useEffect } from "react";
import { I18n } from "i18n-js";
import * as Localization from "expo-localization";
import AsyncStorage from "@react-native-async-storage/async-storage";

// Define translations
const translations = {
  en: {
    routeMap: {
      options: "Route Options",
      summary: "Summary",
      transportMode: "Transport Mode",
      avoidTolls: "Avoid Tolls",
      avoidHighways: "Avoid Highways",
      avoidFerries: "Avoid Ferries",
      units: "Units",
      language: "Language",
      totalDistance: "Total Distance",
      estimatedTime: "Estimated Time",
      start: "Start",
      end: "End",
      step: "Step",
      distance: "Distance",
      duration: "Duration",
      minutes: "minutes",
      transport: {
        car: "Car",
        bike: "Bicycle",
        walk: "On Foot",
        scooter: "Motorcycle",
      },
      unit: {
        kilometers: "Kilometers",
        miles: "Miles",
      },
      languages: {
        french: "French",
        english: "English",
        german: "German",
        spanish: "Spanish",
      },
      searchPlaceholder: "Search for a place",
      currentLocation: "Current Location",
      selectLocations: "Please select a start point and destination",
      reportIncident: "Report Incident",
      selectLocationType: "Set as:",
      setStart: "Starting Point",
      setEnd: "Destination",
      cancel: "Cancel",
      alternateRoutes: "Alternate Routes",
      route: "Route",
    },
    common: {
      edit: "Edit",
      next: "Next",
      skip: "Skip",
      back: "Back",
      cancel: "Cancel",
      confirm: "Confirm",
      save: "Save",
      delete: "Delete",
      loading: "Loading...",
      error: "An error occurred",
      success: "Success!",
      ok: "OK",
      retry: "Retry",
      yes: "Yes",
      no: "No",
    },
    onboarding: {
      slide1: {
        title: "Welcome to EasyGo",
        description:
          "Discover amazing features that will make your life easier",
      },
      slide2: {
        title: "Explore the Map",
        description:
          "Find locations and navigate with our optimized map interface",
      },
      slide3: {
        title: "Stay Connected",
        description: "Get real-time updates and notifications",
      },
      slide4: {
        title: "Ready to Start?",
        description: "Create an account or login to begin your journey",
      },
      getStarted: "Get Started",
    },
    auth: {
      login: {
        title: "Welcome Back",
        subtitle: "Sign in to your account",
        emailLabel: "Email",
        passwordLabel: "Password",
        forgotPassword: "Forgot Password?",
        signIn: "Sign In",
        noAccount: "Don't have an account?",
        signUp: "Sign Up",
        emailRequired: "Email is required",
        emailInvalid: "Enter a valid email",
        passwordRequired: "Password is required",
        passwordTooShort: "Password must be at least 6 characters",
        error: "Login Failed",
        errorMessage: "Invalid email or password. Please try again.",
      },
      register: {
        title: "Create Account",
        subtitle: "Sign up to get started",
        nameLabel: "Full Name",
        emailLabel: "Email",
        passwordLabel: "Password",
        confirmPasswordLabel: "Confirm Password",
        signUp: "Sign Up",
        haveAccount: "Already have an account?",
        signIn: "Sign In",
        success: "Registration Successful",
        successMessage:
          "Your account has been created successfully. You can now log in.",
        error: "Registration Failed",
        errorMessage:
          "There was a problem creating your account. Please try again.",
        nameRequired: "Name is required",
        emailRequired: "Email is required",
        emailInvalid: "Enter a valid email",
        passwordRequired: "Password is required",
        passwordTooShort: "Password must be at least 6 characters",
        passwordsNotMatch: "Passwords must match",
        confirmPasswordRequired: "Confirm password is required",
      },
    },
    map: {
      loading: "Loading map...",
      locationPermissionDenied: "Permission to access location was denied",
      locationError: "Failed to get location",
      searchPlaceholder: "Search here...",
      routePlanner: "Route Planner",
      selectStartPoint: "Select start point",
      selectEndPoint: "Select destination",
      car: "Car",
      bicycle: "Bicycle",
      walking: "Walking",
      waypoints: "Waypoints",
      distance: "Distance",
      duration: "Duration",
      directions: "Directions",
      showDirections: "Show Directions",
      hideDirections: "Hide Directions",
      addWaypoint: "Add Waypoint",
      clearRoute: "Clear Route",
      startPoint: "Start Point",
      endPoint: "End Point",
      waypoint: "Waypoint",
      currentLocation: "Current Location",
      tapToRemove: "Tap to remove",
      calculatingRoute: "Calculating route...",
      routeCalculationError: "Could not calculate route. Please try again.",
      startNavigation: "Start Navigation",
      noRouteToNavigate:
        "No route available for navigation. Please calculate a route first.",
      offRoute: "You are off the route. Recalculating...",
      searchError: "Error searching places",
      routeError: "Error fetching route",
      incidentDescription: "Incident Description",
      submitIncident: "Submit Incident",
      incidentIncomplete: "Please provide an incident description",
    },
    incidents: {
      createNew: "Report new incident",
      selectType: "Select incident type",
      description: "Description",
      descriptionPlaceholder: "Describe what happenedâ€¦",
      expectedDuration: "Expected duration (min)",
      expectedDurationPlaceholder: "Enter duration in minutes (optional)",
      locationInfo: "Location:",
      locationUnavailable: "Location unavailable",
      create: "Create incident",
      createSuccess: "Incident reported successfully",
      createError: "Failed to report incident",
      filterTitle: "Filter incidents",
      filterByType: "By type",
      filterByRadius: "By radius",
      activeOnly: "Active incidents only",
      showOnlyMine: "Show only my incidents",
      resetFilters: "Reset filters",
      applyFilters: "Apply filters",
      filtersApplied: "Filters applied",
      types: {
        accident: "Accident",
        construction: "Construction",
        police: "Police",
        hazard: "Hazard",
        closure: "Closure",
        trafficJam: "Traffic Jam",
      },
    },
    pings: {
      activate: "Activate",
      deactivate: "Deactivate",
      activateSuccess: "Ping activated successfully",
      activateError: "Failed to activate ping",
      deactivateSuccess: "Ping deactivated successfully",
      deactivateError: "Failed to deactivate ping",
      createNew: "Create New Ping",
      selectType: "Select Ping Type",
      description: "Description",
      descriptionPlaceholder: "Enter a description for this ping...",
      locationInfo: "Location: ",
      locationUnavailable: "Location unavailable",
      create: "Create Ping",
      edit: "Edit",
      editPing: "Edit Ping",
      delete: "Delete",
      confirmDelete: "Confirm Delete",
      update: "Update",
      isActive: "Active",
      createdAt: "Created At",
      status: "Status",
      location: "Location",
      active: "Active",
      inactive: "Inactive",
      loading: "Loading ping details...",
      filterTitle: "Filter Pings",
      filterByType: "Filter by Type",
      filterByRadius: "Filter by Radius (km)",
      kilometers: "km",
      activeOnly: "Show Active Pings Only",
      showOnlyMine: "Show Only My Pings",
      resetFilters: "Reset Filters",
      applyFilters: "Apply Filters",
      filtersApplied: "Filters Applied",
      createSuccess: "Ping created successfully",
      createError: "Failed to create ping",
      updateSuccess: "Ping updated successfully",
      updateError: "Failed to update ping",
      deleteSuccess: "Ping deleted successfully",
      deleteError: "Failed to delete ping",
      fetchError: "Failed to fetch pings",
      types: {
        bouchon: "plug",
        accident: "accident",
        nid_de_poule: "pothole",
      },
    },
    profile: {
      defaultName: "User",
      editProfile: "Edit Profile",
      settings: "Settings",
      darkMode: "Dark Mode",
      language: "Language",
      notifications: "Notifications",
      logout: "Logout",
      logoutConfirmTitle: "Confirm Logout",
      logoutConfirmMessage: "Are you sure you want to log out?",
      cameraPermissionDenied: "Permission to access camera was denied",
      loading: "Loading profile...",
      avatarUpdateTitle: "Avatar Update",
      avatarUpdateMessage:
        "Avatar update functionality is not fully implemented yet.",
      preferences: "Preferences",
      recentRoutes: "Recent Routes",
      viewAll: "View All",
      noRoutes: "You don't have any saved routes yet",
      createRoute: "Create Route",
      allRoutes: "All Routes",
      roles: {
        admin: "Administrator",
        user: "User",
        moderator: "Moderator",
      },
      edit: {
        title: "Edit Profile",
        changePhoto: "Change Photo",
        personalInfo: "Personal Information",
        nameLabel: "Full Name",
        emailLabel: "Email",
        phoneLabel: "Phone Number",
        bioLabel: "Bio",
        nameRequired: "Name is required",
        emailRequired: "Email is required",
        emailInvalid: "Enter a valid email",
        saveChanges: "Save Changes",
        notificationPreferences: "Notification Preferences",
        emailNotifications: "Email Notifications",
        emailNotificationsDesc: "Receive updates and alerts via email",
        pushNotifications: "Push Notifications",
        pushNotificationsDesc:
          "Receive notifications in real-time on your device",
        success: "Profile Updated",
        successMessage: "Your profile has been updated successfully.",
        error: "Update Failed",
        errorMessage:
          "There was a problem updating your profile. Please try again.",
        userNotFound: "User information not found. Please try again.",
      },
    },
    notifications: {
      title: "Notifications",
      empty: "You don't have any notifications yet",
      loading: "Loading notifications...",
      refresh: "Refresh",
      markAllRead: "Mark all as read",
      clearAll: "Clear all",
      fetchError: "Failed to load notifications",
      tryAgain: "Try Again",
    },
    preferences: {
      title: "Navigation Preferences",
      transportMode: "Default Transport Mode",
      routeOptions: "Route Options",
      avoidTolls: "Avoid Tolls",
      avoidHighways: "Avoid Highways",
      distanceUnit: "Distance Unit",
      kilometers: "Kilometers (km)",
      miles: "Miles (mi)",
      saveChanges: "Save Preferences",
      success: "Preferences Updated",
      successMessage:
        "Your navigation preferences have been updated successfully.",
      error: "Update Failed",
      errorMessage:
        "There was a problem updating your preferences. Please try again.",
      userNotFound: "User information not found. Please try again.",
    },
    routes: {
      noTolls: "Avoid tolls",
      savedRoutes: "Saved Routes",
      new: "New",
      createRoute: "Create Route",
      noRoutes: "You don't have any saved routes yet",
      loading: "Loading routes...",
      fetchError: "Failed to load routes",
      from: "From",
      to: "To",
      avoidTolls: "Avoid Tolls",
      createNew: "Create New Route",
      startPoint: "Start Point",
      endPoint: "End Point",
      latitude: "Latitude",
      longitude: "Longitude",
      transportMode: "Transport Mode",
      calculate: "Calculate Route",
      save: "Save",
      recalculate: "Recalculate",
      routeCalculated: "Route calculated successfully",
      routeDetails: "Route Details",
      createdAt: "Created At",
      navigate: "Navigate",
      delete: "Delete",
      confirmDelete: "Confirm Delete",
      createSuccess: "Route created successfully",
      activeRoute: "Active Route",
    },
  },
  fr: {
    routeMap: {
      options: "Options d'itinÃ©raire",
      summary: "RÃ©capitulatif",
      transportMode: "Mode de transport",
      avoidTolls: "Ã‰viter les pÃ©ages",
      avoidHighways: "Ã‰viter les autoroutes",
      avoidFerries: "Ã‰viter les ferries",
      units: "UnitÃ©s",
      language: "Langue",
      totalDistance: "Distance totale",
      estimatedTime: "Temps estimÃ©",
      start: "DÃ©part",
      end: "ArrivÃ©e",
      step: "Ã‰tape",
      distance: "Distance",
      duration: "DurÃ©e",
      minutes: "minutes",
      transport: {
        car: "Voiture",
        bike: "VÃ©lo",
        walk: "Ã€ pied",
        scooter: "Moto",
      },
      unit: {
        kilometers: "KilomÃ¨tres",
        miles: "Miles",
      },
      languages: {
        french: "FranÃ§ais",
        english: "Anglais",
        german: "Allemand",
        spanish: "Espagnol",
      },
      searchPlaceholder: "Rechercher un lieu",
      currentLocation: "Position actuelle",
      selectLocations:
        "Veuillez sÃ©lectionner un point de dÃ©part et une destination",
      reportIncident: "Signaler un incident",
      selectLocationType: "DÃ©finir comme :",
      setStart: "Point de dÃ©part",
      setEnd: "Destination",
      cancel: "Annuler",
      alternateRoutes: "ItinÃ©raires alternatifs",
      route: "ItinÃ©raire",
    },
    common: {
      edit: "Modifier",
      next: "Suivant",
      skip: "Passer",
      back: "Retour",
      cancel: "Annuler",
      confirm: "Confirmer",
      save: "Enregistrer",
      delete: "Supprimer",
      loading: "Chargement...",
      error: "Une erreur est survenue",
      success: "SuccÃ¨s !",
      ok: "OK",
      retry: "RÃ©essayer",
      yes: "Oui",
      no: "Non",
    },
    onboarding: {
      slide1: {
        title: "Bienvenue sur EasyGo",
        description:
          "DÃ©couvrez des fonctionnalitÃ©s incroyables qui vous faciliteront la vie",
      },
      slide2: {
        title: "Explorez la Carte",
        description:
          "Trouvez des lieux et naviguez avec notre interface de carte optimisÃ©e",
      },
      slide3: {
        title: "Restez ConnectÃ©",
        description:
          "Recevez des mises Ã  jour et des notifications en temps rÃ©el",
      },
      slide4: {
        title: "PrÃªt Ã  Commencer ?",
        description:
          "CrÃ©ez un compte ou connectez-vous pour commencer votre voyage",
      },
      getStarted: "Commencer",
    },
    auth: {
      login: {
        title: "Bon Retour",
        subtitle: "Connectez-vous Ã  votre compte",
        emailLabel: "Email",
        passwordLabel: "Mot de passe",
        forgotPassword: "Mot de passe oubliÃ© ?",
        signIn: "Se Connecter",
        noAccount: "Vous n'avez pas de compte ?",
        signUp: "S'inscrire",
        emailRequired: "L'email est requis",
        emailInvalid: "Entrez un email valide",
        passwordRequired: "Le mot de passe est requis",
        passwordTooShort: "Le mot de passe doit contenir au moins 6 caractÃ¨res",
        error: "Ã‰chec de connexion",
        errorMessage: "Email ou mot de passe invalide. Veuillez rÃ©essayer.",
      },
      register: {
        title: "CrÃ©er un Compte",
        subtitle: "Inscrivez-vous pour commencer",
        nameLabel: "Nom complet",
        emailLabel: "Email",
        passwordLabel: "Mot de passe",
        confirmPasswordLabel: "Confirmer le mot de passe",
        signUp: "S'inscrire",
        haveAccount: "Vous avez dÃ©jÃ  un compte ?",
        signIn: "Se Connecter",
        success: "Inscription RÃ©ussie",
        successMessage:
          "Votre compte a Ã©tÃ© crÃ©Ã© avec succÃ¨s. Vous pouvez maintenant vous connecter.",
        error: "Ã‰chec de l'inscription",
        errorMessage:
          "Un problÃ¨me est survenu lors de la crÃ©ation de votre compte. Veuillez rÃ©essayer.",
        nameRequired: "Le nom est requis",
        emailRequired: "L'email est requis",
        emailInvalid: "Entrez un email valide",
        passwordRequired: "Le mot de passe est requis",
        passwordTooShort: "Le mot de passe doit contenir au moins 6 caractÃ¨res",
        passwordsNotMatch: "Les mots de passe ne correspondent pas",
        confirmPasswordRequired: "La confirmation du mot de passe est requise",
      },
    },
    map: {
      loading: "Chargement de la carte...",
      locationPermissionDenied:
        "L'autorisation d'accÃ¨s Ã  la localisation a Ã©tÃ© refusÃ©e",
      locationError: "Ã‰chec de l'obtention de la localisation",
      searchPlaceholder: "Rechercher ici...",
      routePlanner: "Planificateur d'itinÃ©raire",
      selectStartPoint: "SÃ©lectionner le point de dÃ©part",
      selectEndPoint: "SÃ©lectionner la destination",
      car: "Voiture",
      bicycle: "VÃ©lo",
      walking: "Ã€ pied",
      waypoints: "Points intermÃ©diaires",
      distance: "Distance",
      duration: "DurÃ©e",
      directions: "Directions",
      showDirections: "Afficher les directions",
      hideDirections: "Masquer les directions",
      addWaypoint: "Ajouter un point",
      clearRoute: "Effacer l'itinÃ©raire",
      startPoint: "Point de dÃ©part",
      endPoint: "Destination",
      waypoint: "Point intermÃ©diaire",
      currentLocation: "Position actuelle",
      tapToRemove: "Appuyez pour supprimer",
      calculatingRoute: "Calcul de l'itinÃ©raire...",
      routeCalculationError:
        "Impossible de calculer l'itinÃ©raire. Veuillez rÃ©essayer.",
      startNavigation: "DÃ©marrer la navigation",
      noRouteToNavigate:
        "Aucun itinÃ©raire disponible pour la navigation. Veuillez d'abord calculer un itinÃ©raire.",
      offRoute: "Vous Ãªtes hors de l'itinÃ©raire. Recalcul en cours...",
      searchError: "Erreur lors de la recherche de lieux",
      routeError: "Erreur lors de la rÃ©cupÃ©ration de l'itinÃ©raire",
      incidentDescription: "Description de l'incident",
      submitIncident: "Soumettre l'incident",
      incidentIncomplete: "Veuillez fournir une description de l'incident",
    },
    incidents: {
      createNew: "Signaler un incident",
      selectType: "SÃ©lectionnez le type",
      description: "Description",
      descriptionPlaceholder: "DÃ©crivez ce qui s'est passÃ©â€¦",
      expectedDuration: "DurÃ©e estimÃ©e (min)",
      expectedDurationPlaceholder: "Entrez la durÃ©e en minutes (optionnel)",
      locationInfo: "Emplacement :",
      locationUnavailable: "Localisation indisponible",
      create: "CrÃ©er l'incident",
      createSuccess: "Incident signalÃ© avec succÃ¨s",
      createError: "Ã‰chec du signalement",
      filterTitle: "Filtrer les incidents",
      filterByType: "Par type",
      filterByRadius: "Par rayon",
      activeOnly: "Uniquement actifs",
      showOnlyMine: "Mes incidents seulement",
      resetFilters: "RÃ©initialiser",
      applyFilters: "Appliquer",
      filtersApplied: "Filtres appliquÃ©s",
      types: {
        accident: "Accident",
        construction: "Travaux",
        police: "Police",
        hazard: "Danger",
        closure: "Fermeture",
        trafficJam: "Embouteillage",
      },
    },
    pings: {
      activate: "Activer",
      deactivate: "DÃ©sactiver",
      activateSuccess: "Ping activÃ© avec succÃ¨s",
      activateError: "Erreur lors de l'activation du ping",
      deactivateSuccess: "Ping dÃ©sactivÃ© avec succÃ¨s",
      deactivateError: "Erreur lors de la dÃ©sactivation du ping",
      createNew: "CrÃ©er un nouveau Ping",
      selectType: "SÃ©lectionner le type de Ping",
      description: "Description",
      descriptionPlaceholder: "Entrez une description pour ce ping...",
      locationInfo: "Emplacement: ",
      locationUnavailable: "Emplacement indisponible",
      create: "CrÃ©er Ping",
      edit: "Modifier",
      editPing: "Modifier le Ping",
      delete: "Supprimer",
      confirmDelete: "Confirmer la suppression",
      update: "Mettre Ã  jour",
      isActive: "Actif",
      createdAt: "CrÃ©Ã© le",
      status: "Statut",
      location: "Emplacement",
      active: "Actif",
      inactive: "Inactif",
      loading: "Chargement des dÃ©tails du ping...",
      filterTitle: "Filtrer les Pings",
      filterByType: "Filtrer par Type",
      filterByRadius: "Filtrer par Rayon (km)",
      kilometers: "km",
      activeOnly: "Afficher uniquement les Pings actifs",
      showOnlyMine: "Afficher uniquement mes Pings",
      resetFilters: "RÃ©initialiser les filtres",
      applyFilters: "Appliquer les filtres",
      filtersApplied: "Filtres appliquÃ©s",
      createSuccess: "Ping crÃ©Ã© avec succÃ¨s",
      createError: "Ã‰chec de la crÃ©ation du ping",
      updateSuccess: "Ping mis Ã  jour avec succÃ¨s",
      updateError: "Ã‰chec de la mise Ã  jour du ping",
      deleteSuccess: "Ping supprimÃ© avec succÃ¨s",
      deleteError: "Ã‰chec de la suppression du ping",
      fetchError: "Ã‰chec du chargement des pings",
      types: {
        bouchon: "bouchon",
        accident: "accident",
        nid_de_poule: "nid de poule",
      },
    },
    profile: {
      defaultName: "Utilisateur",
      editProfile: "Modifier le Profil",
      settings: "ParamÃ¨tres",
      darkMode: "Mode Sombre",
      language: "Langue",
      notifications: "Notifications",
      logout: "DÃ©connexion",
      logoutConfirmTitle: "Confirmer la dÃ©connexion",
      logoutConfirmMessage: "ÃŠtes-vous sÃ»r de vouloir vous dÃ©connecter ?",
      cameraPermissionDenied:
        "L'autorisation d'accÃ¨s Ã  la camÃ©ra a Ã©tÃ© refusÃ©e",
      loading: "Chargement du profil...",
      avatarUpdateTitle: "Mise Ã  jour de l'avatar",
      avatarUpdateMessage:
        "La fonctionnalitÃ© de mise Ã  jour de l'avatar n'est pas encore complÃ¨tement implÃ©mentÃ©e.",
      preferences: "PrÃ©fÃ©rences",
      recentRoutes: "ItinÃ©raires RÃ©cents",
      viewAll: "Voir Tout",
      noRoutes: "Vous n'avez pas encore d'itinÃ©raires enregistrÃ©s",
      createRoute: "CrÃ©er un ItinÃ©raire",
      allRoutes: "Tous les ItinÃ©raires",
      roles: {
        admin: "Administrateur",
        user: "Utilisateur",
        moderator: "ModÃ©rateur",
      },
      edit: {
        title: "Modifier le Profil",
        changePhoto: "Changer la Photo",
        personalInfo: "Informations Personnelles",
        nameLabel: "Nom Complet",
        emailLabel: "Email",
        phoneLabel: "NumÃ©ro de TÃ©lÃ©phone",
        bioLabel: "Biographie",
        nameRequired: "Le nom est requis",
        emailRequired: "L'email est requis",
        emailInvalid: "Entrez un email valide",
        saveChanges: "Enregistrer les Modifications",
        notificationPreferences: "PrÃ©fÃ©rences de Notification",
        emailNotifications: "Notifications par Email",
        emailNotificationsDesc:
          "Recevoir des mises Ã  jour et des alertes par email",
        pushNotifications: "Notifications Push",
        pushNotificationsDesc:
          "Recevoir des notifications en temps rÃ©el sur votre appareil",
        success: "Profil Mis Ã  Jour",
        successMessage: "Votre profil a Ã©tÃ© mis Ã  jour avec succÃ¨s.",
        error: "Ã‰chec de la mise Ã  jour",
        errorMessage:
          "Un problÃ¨me est survenu lors de la mise Ã  jour de votre profil. Veuillez rÃ©essayer.",
        userNotFound:
          "Informations utilisateur non trouvÃ©es. Veuillez rÃ©essayer.",
      },
    },
    preferences: {
      title: "PrÃ©fÃ©rences de Navigation",
      transportMode: "Mode de Transport par DÃ©faut",
      routeOptions: "Options d'ItinÃ©raire",
      avoidTolls: "Ã‰viter les PÃ©ages",
      avoidHighways: "Ã‰viter les Autoroutes",
      distanceUnit: "UnitÃ© de Distance",
      kilometers: "KilomÃ¨tres (km)",
      miles: "Miles (mi)",
      saveChanges: "Enregistrer les PrÃ©fÃ©rences",
      success: "PrÃ©fÃ©rences Mises Ã  Jour",
      successMessage:
        "Vos prÃ©fÃ©rences de navigation ont Ã©tÃ© mises Ã  jour avec succÃ¨s.",
      error: "Ã‰chec de la mise Ã  jour",
      errorMessage:
        "Un problÃ¨me est survenu lors de la mise Ã  jour de vos prÃ©fÃ©rences. Veuillez rÃ©essayer.",
      userNotFound:
        "Informations utilisateur non trouvÃ©es. Veuillez rÃ©essayer.",
    },
    notifications: {
      title: "Notifications",
      empty: "Vous n'avez pas encore de notifications",
      loading: "Chargement des notifications...",
      refresh: "Actualiser",
      markAllRead: "Tout marquer comme lu",
      clearAll: "Tout effacer",
      fetchError: "Ã‰chec du chargement des notifications",
      tryAgain: "RÃ©essayer",
    },
    routes: {
      noTolls: "Ã‰viter les pÃ©ages",
      savedRoutes: "ItinÃ©raires enregistrÃ©s",
      new: "Nouveau",
      createRoute: "CrÃ©er un itinÃ©raire",
      noRoutes: "Vous n'avez pas encore d'itinÃ©raires enregistrÃ©s",
      loading: "Chargement des itinÃ©raires...",
      fetchError: "Erreur lors du chargement des itinÃ©raires",
      from: "De",
      to: "Ã€",
      avoidTolls: "Ã‰viter les pÃ©ages",
      createNew: "CrÃ©er un nouvel itinÃ©raire",
      startPoint: "Point de dÃ©part",
      endPoint: "Point d'arrivÃ©e",
      latitude: "Latitude",
      longitude: "Longitude",
      transportMode: "Mode de transport",
      calculate: "Calculer l'itinÃ©raire",
      save: "Enregistrer",
      recalculate: "Recalculer",
      routeCalculated: "ItinÃ©raire calculÃ© avec succÃ¨s",
      routeDetails: "DÃ©tails de l'itinÃ©raire",
      createdAt: "CrÃ©Ã© le",
      navigate: "Naviguer",
      delete: "Supprimer",
      confirmDelete: "Confirmer la suppression",
      createSuccess: "ItinÃ©raire crÃ©Ã© avec succÃ¨s",
      activeRoute: "ItinÃ©raire actif",
    },
  },
};

export default translations;

// Create i18n instance
const i18n = new I18n(translations);

// Create language context
type LanguageContextType = {
  t: (key: string, options?: object) => string;
  language: string;
  changeLanguage: (lang: string) => void;
};

const LanguageContext = createContext<LanguageContextType | undefined>(
  undefined
);

// Storage key for language preference
const LANGUAGE_STORAGE_KEY = "user_language_preference";

export const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({
  children,
}) => {
  const [language, setLanguage] = useState("en"); // Default to English

  // Load saved language preference or use device locale
  useEffect(() => {
    const loadLanguage = async () => {
      try {
        const savedLanguage = await AsyncStorage.getItem(LANGUAGE_STORAGE_KEY);

        if (savedLanguage) {
          setLanguage(savedLanguage);
        } else {
          // Use device locale, but only if it's one of our supported languages
          const deviceLocale = Localization.locale.split("-")[0]; // Get language code without region
          if (deviceLocale === "fr" || deviceLocale === "en") {
            setLanguage(deviceLocale);
          }
        }
      } catch (error) {
        console.error("Error loading language preference:", error);
      }
    };

    loadLanguage();
  }, []);

  // Update i18n when language changes
  useEffect(() => {
    i18n.locale = language;
  }, [language]);

  // Function to change language
  const changeLanguage = async (lang: string) => {
    setLanguage(lang);
    try {
      await AsyncStorage.setItem(LANGUAGE_STORAGE_KEY, lang);
    } catch (error) {
      console.error("Error saving language preference:", error);
    }
  };

  // Translation function
  const t = (key: string, options?: object) => {
    return i18n.t(key, options);
  };

  return (
    <LanguageContext.Provider value={{ t, language, changeLanguage }}>
      {children}
    </LanguageContext.Provider>
  );
};

export const useTranslation = () => {
  const context = useContext(LanguageContext);
  if (context === undefined) {
    throw new Error("useTranslation must be used within a LanguageProvider");
  }
  return context;
};
